<!DOCTYPE flight_plan SYSTEM "../flight_plan.dtd">

<flight_plan alt="1.5" ground_alt="0" lat0="51.990634" lon0="4.376789"
	max_dist_from_home="8" name="Test flight plan Steven" security_height="0.4">
	<header>
		#include "autopilot.h"
		#include "subsystems/ahrs.h"
		#include "subsystems/electrical.h"
		#include "subsystems/datalink/datalink.h"
	</header>
	<waypoints>
		<waypoint height="0" name="HOME" x="0.0" y="0.0" />
		<waypoint height="5" name="CLIMB" x="1.2" y="-0.6" />
		<waypoint name="GOAL" x="2.0" y="2.0" />
		<waypoint height="1.342321" name="STDBY" x="-0.7" y="-0.8" />
		<waypoint name="TD" x="0.8" y="-1.7" />
		<waypoint name="p1" x="0.0" y="0.0" />
		<waypoint name="p2" x="2.0" y="0.0" />
		<waypoint lat="51.9906213" lon="4.3768628" name="_CZ1" />
		<waypoint lat="51.9905874" lon="4.3767766" name="_CZ2" />
		<waypoint lat="51.9906409" lon="4.3767226" name="_CZ3" />
		<waypoint lat="51.990667" lon="4.376806" name="_CZ4" />
		<waypoint lat="51.990624" lon="4.376845" name="_OZ1" />
		<waypoint lat="51.990601" lon="4.376782" name="_OZ2" />
		<waypoint alt="11.5" lat="51.990638" lon="4.376748" name="_OZ3" />
		<waypoint lat="51.990657" lon="4.376804" name="_OZ4" />
	</waypoints>
	<sectors>
		<sector color="red" name="CyberZoo">
			<corner name="_CZ1" />
			<corner name="_CZ2" />
			<corner name="_CZ3" />
			<corner name="_CZ4" />
		</sector>
		<sector color="#FF9922" name="ObstacleZone">
			<corner name="_OZ1" />
			<corner name="_OZ2" />
			<corner name="_OZ3" />
			<corner name="_OZ4" />
		</sector>
	</sectors>
	<variables>
		<variable var="selfradius" min="-6" max="6" step="0.1" />
	</variables>
	<exceptions>
		<exception cond="!InsideCyberZoo(GetPosX(), GetPosY())" deroute="Standby" />
		<!--exception cond="datalink_time > 2" deroute="land here" /-->
		<!-- exception cond="electrical.bat_low && !(nav_block == IndexOfBlock('land')) && !(nav_block == IndexOfBlock('flare')) && !(nav_block == IndexOfBlock('landed'))"	deroute="land" />
		<exception cond="electrical.bat_critical && !(nav_block == IndexOfBlock('land')) && !(nav_block == IndexOfBlock('flare')) && !(nav_block == IndexOfBlock('landed'))" deroute="land here" /-->
	</exceptions>
	<blocks>
		<block name="Wait GPS">
			<call_once fun="NavKillThrottle()" />
			<while cond="!GpsFixValid()" />
		</block>
		<block name="Holding point">
			<call_once fun="NavKillThrottle()" />
			<attitude pitch="0" roll="0" throttle="0" until="FALSE"
				vmode="throttle" />
		</block>
		<block name="Start Engine">
			<call_once fun="NavResurrect()" />
			<attitude pitch="0" roll="0" throttle="0" until="FALSE"
				vmode="throttle" />
		</block>
		<block name="Takeoff" strip_button="Takeoff" strip_icon="takeoff.png">
			<exception cond="stateGetPositionEnu_f()->z > 1.0" deroute="Standby" />
			<call_once fun="NavSetWaypointHere(WP_CLIMB)" />
			<stay climb="nav_climb_vspeed" vmode="climb" wp="CLIMB" />
		</block>
		<block name="Standby" strip_button="Standby" strip_icon="home.png">
			<stay wp="STDBY" />
		</block>
		<block name="START" strip_button="Go" strip_icon="lookfore.png">
			<call_once fun="NavSetWaypointHere(WP_GOAL)" />
		</block>
		<block name="StayGoal">
			<stay wp="GOAL" />
		</block>
		<block name="stay_p1">
			<stay wp="p1" />
		</block>
		<block name="go_p2">
			<call_once fun="nav_set_heading_deg(90)" />
			<go wp="p2" />
			<deroute block="stay_p1" />
		</block>
		<block name="Circle">
			<while cond="TRUE">
				<circle wp="GOAL" radius="selfradius" />
			</while>
		</block>
		<block name="land here" strip_button="land Here" strip_icon="land-right.png">
			<call_once fun="NavSetWaypointHere(WP_TD)" />
		</block>
		<block name="land">
			<go wp="TD" />
		</block>
		<block name="flare">
			<exception cond="NavDetectGround()" deroute="Holding point" />
			<exception cond="!nav_is_in_flight()" deroute="landed" />
			<call_once fun="NavStartDetectGround()" />
			<stay climb="nav_descend_vspeed" vmode="climb" wp="TD" />
		</block>
		<block name="landed">
			<call_once fun="NavKillThrottle()" />
			<attitude pitch="0" roll="0" throttle="0" until="FALSE"
				vmode="throttle" />
		</block>
	</blocks>
</flight_plan>
