<!DOCTYPE flight_plan SYSTEM "../flight_plan.dtd">

<flight_plan alt="1" ground_alt="0" lat0="51.990634" lon0="4.376789"
	max_dist_from_home="8" name="imav2017_cooperativecarry" security_height="0.4">
	<header>
		#include "autopilot.h"
		#include "subsystems/radio_control.h"
		#include "subsystems/ahrs.h"
		#include "subsystems/electrical.h"
		#include "subsystems/datalink/datalink.h"
	</header>
	<waypoints>
		<waypoint height="0" name="HOME" x="0.0" y="0.0" />
		<waypoint height="1" name="CLIMB" x="1.2" y="-0.6" />
		<waypoint height = "3.0" name="GOAL" x="0.0" y="0.0" />
		<waypoint name="TD" x="0.8" y="-1.7" />
		<waypoint height="1.0" name="STDBY" x="-1.5" y="-1.5" />
		<waypoint lat="51.9906873" lon="4.3768069" name="_DZ1" />
		<waypoint lat="51.9906496" lon="4.3767068" name="_DZ2" />
		<waypoint lat="51.9905876" lon="4.3767679" name="_DZ3" />
		<waypoint lat="51.9906254" lon="4.3768677" name="_DZ4" />
	</waypoints>
	<sectors>
		<sector color="orange" name="DangerZone">
			<corner name="_DZ1" />
			<corner name="_DZ2" />
			<corner name="_DZ3" />
			<corner name="_DZ4" />
		</sector>
	</sectors>
	<variables>
		<variable var="selfradius" min="-6" max="6" step="0.1" />
	</variables>
	<exceptions>
		<exception cond="datalink_time>=2" deroute="Force kill engines"/>
		<exception cond="radio_control.status == RC_REALLY_LOST" deroute="Force kill engines"/>
	</exceptions>
	<blocks>
		    <block name="FPInit">
      <while cond="!GpsFixValid()"/>
      <while cond="1"/>
    </block>
		<block name="Force start engines">
				<call_once fun="guidance_v_set_guided_th(0.2)"/>
         		<call_once fun="autopilot_set_motors_on(TRUE)"/>
          		<while cond="1"/>
      	        </block>
		<block name="hover_guided">
	        <call_once fun="guidance_v_set_guided_th(0.75)"/>
			<while cond="TRUE">
				<call fun="hoverGuided(1.5)"/>
			</while>
		</block>
		<block name="track_relative_position">
			<while cond="TRUE">
				<call fun="trackRelPos(1.5)"/>
			</while>
		</block>
		<block name="fly_forward">
			<while cond="TRUE">
				<call fun="setForwardVelocity(0.3, 1.5)"/>
			</while>
            <exception cond="block_time>5" deroute="hover_guided"/>
		</block>
		<block name="fly_forward_delay">
			<while cond="TRUE">
				<call fun="hoverGuided(1.5)"/>
			</while>
            <exception cond="block_time>2" deroute="fly_forward"/>
		</block>
		<block name="fly_forward_and_track">
			<while cond="TRUE">
				<call fun="setForwardAndTrack(0.3, 1.5)"/>
			</while>
            <exception cond="block_time>5" deroute="track_relative_position"/>
		</block>
		<block name="track_other">
			<while cond="TRUE">
				<call fun="trackOther(1.5)"/>
			</while>
		</block>
		<block name="track_velocity">
			<while cond="TRUE">
				<call fun="trackVelocity(1.5)"/>
			</while>
		</block>
		<block name="land_guided">
			<call fun="goLand()"/>
			<deroute block="FPInit"/>
		</block>
		<block name="Force kill engines">
         		<call_once fun="autopilot_set_motors_on(FALSE)"/>
          		<while cond="1"/>
      	        </block>
	</blocks>
</flight_plan>
